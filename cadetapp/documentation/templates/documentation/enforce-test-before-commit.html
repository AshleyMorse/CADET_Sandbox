<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.15b.dev: http://docutils.sourceforge.net/" />
<title>Automatically Execute Tests</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="automatically-execute-tests">
<h1 class="title">Automatically Execute Tests</h1>

<!-- This work is licensed under a Creative Commons 3.0 Unported License.

http://creativecommons.org/licenses/by/3.0/legalcode -->
<p>To help maintain a stable code base, test should be run automatically
before code can be submitted for review. This helps ensure that the code
base is stable and that no existing features have been impacted by the
latest enhancement. The tests should be run automatically as part of a
larger pre-commit process.</p>
<div class="section" id="problem-description">
<h1>Problem Description</h1>
<p>As multiple developers write and interact with the code, the opportunity
for unintended impacts of changes grows exponentionally. Running unit tests
early and often will help reduce the chance of unintended consequences
from each commit. Forcing developers to write and execute tests helps
ensure that the code base is stable and that future errors will be caught
with the newest tests. The easiest way to enforce test execution is to make
it part of the pre-commit process. Since Arcanist already provides options
for pre-commit hooks, Arcanist will need to be configured to leverage
third party testing tools to enforce code coverage and code stability
<a class="citation-reference" href="#arccoverage" id="id1">[ArcCoverage]</a></p>
<div class="section" id="requirements">
<h2>Requirements</h2>
<blockquote>
<ul class="simple">
<li>The solution shall automatically execute unit tests before each commit</li>
<li>The solution shall provide the developer with an output of code coverage
for each of the files included in the commit</li>
<li>The solution shall enforce a certain percentage of code coverage for all
files included in the commit</li>
<li>The solution shall prevent any code from being committed if a test fails.</li>
</ul>
</blockquote>
</div>
<div class="section" id="use-cases">
<h2>Use Cases</h2>
<p>Name: Tests Are Run Automatically</p>
<dl class="docutils">
<dt>Actors:</dt>
<dd><ul class="first last simple">
<li><dl class="first docutils">
<dt>Developer</dt>
<dd>Person who has written code that needs to be evaluated</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Arcanist</dt>
<dd>Framework/tool to automatically run tests during commit process</dd>
</dl>
</li>
</ul>
</dd>
<dt>Preconditions:</dt>
<dd><ul class="first last simple">
<li>Developer has properly installed Arcanist</li>
<li>Developer has properly configured git</li>
<li>Developer has written code that needs to be submitted</li>
</ul>
</dd>
<dt>Error Flow:</dt>
<dd>After the developer has finished writing the code, the developer runs the
<tt class="docutils literal">arc diff</tt> command to kick off the process of committing code for review.
During the diff process, Arcanist automatically executes a testing library
that executes and evaluates all relevant unit tests for the commit. The
test library finds that a test has failed and returns the failure.
Arcanist presents the user with the error and stops the commit process.</dd>
<dt>Post Conditions:</dt>
<dd><ul class="first last simple">
<li>The commit has been halted.</li>
<li>The developer has been provided information regarding a failing test
and is instructed to address the test failure</li>
</ul>
</dd>
<dt>Clean Flow:</dt>
<dd>After the developer has finished writing the code, the developer runs the
<tt class="docutils literal">arc diff</tt> command to kick off the process of committing code for review.
During the diff process, Arcanist automatically executes a testing library
that executes and evaluates all relevant unit tests for the commit. The
test library does not find any failed tests and returns success. Arcanist
allows the diff process to continue. The code is committed</dd>
<dt>Post Conditions:</dt>
<dd><ul class="first last simple">
<li>The commit has successfully completed</li>
<li>The developer has been presented a success message</li>
</ul>
</dd>
<dt>Lack Of Coverage Flow:</dt>
<dd>After the developer has finished writing the code, the developer runs the
<tt class="docutils literal">arc diff</tt> command to kick off the process of committing code for review.
During the diff process, Arcanist automatically executes a testing library
that executes and evaluates all relevant unit tests for the commit. The
test library does not find any tests to run and returns an error.
Arcanist presents the user with an alert regarding insufficient test
coverage. Arcanist stops the commit process.</dd>
<dt>Post Conditions:</dt>
<dd><ul class="first last simple">
<li>The commit has been halted.</li>
<li>The developer has been directed to add additional tests.</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="proposed-change">
<h1>Proposed Change</h1>
<p>Arcanist's unit testing process is to be configured to execute the PyTest
framework.[PyTest]_ Pytest will be installed and configured to appropriately
locate tests and execute them. In addition, PyTest will be configured to
incorporate Coverage.py which will help to evaluate code coverage based
on the tests provided by the developers. Coverage.py will need to be
installed and configured as appropriate.[CoveragePy]_</p>
<p>In order to include a code coverage evaluation and failure condition, a
custom unit testing workflow will need to be created. This will be
accomplished using Phabricator's available interfaces. <a class="citation-reference" href="#arcanisttesting" id="id2">[ArcanistTesting]</a>.
This custom testing framework will execute unit tests and also evaluate
code coverage. If a test fails or the code coverage drops below an
agreed-upon level, the commit will fail and the developer will be alerted
to the issues encountered.</p>
<p>The automatic testing feature will work hand-in-hand with the automated
linting feature to comprise the entirety of the pre-commit analysis workflow
for all code that is committed to the repository. The unit testing and
linting components are independently handled by Arcanist already, so the
integration process will be seamless.</p>
<div class="section" id="alternatives">
<h2>Alternatives</h2>
<p>There are other testing libraries available for use with Python. PyTest was
chosen because of its ability to incorporate Coverage.py which would provide
code coverage analysis in addition to test execution. This feature is the
key differentiator between other unit testing frameworks for Python.</p>
</div>
</div>
<div class="section" id="testing">
<h1>Testing</h1>
<p>To properly test the configurations, Arcanist's unit testing commands will
be executed outside of the commit process to verify that the PyTest framework
has been properly configured.</p>
<p>To test the pre-commit hook, code that causes a sample test to fail will be
submitted for review to trigger the automatic testing process</p>
</div>
<div class="section" id="documentation">
<h1>Documentation</h1>
<p>Each configuration setting shall include inline documentation identifying
what the specific setting addresses.</p>
<p>The custom test framework shall include inline documentation for all methods
and classes created.</p>
<p>The custom test framework shall also have a developer guide that will explain
the purpose and configuration of the test framework. This document will be
similar in use to a unix'manual page'</p>
</div>
<div class="section" id="implementation">
<h1>Implementation</h1>
<div class="section" id="work-items">
<h2>Work Items</h2>
<ul class="simple">
<li>Configure PyTest<ul>
<li>Validate installation and configuration</li>
<li>Install Coverage.py</li>
<li>Validate Coverage.py installation and configuration</li>
<li>Generate documentation</li>
<li>Deploy basic Unit test pre-commit hook without code coverage
evaluation</li>
</ul>
</li>
<li>Create Custom Test Framework<ul>
<li>Scaffold custom framework</li>
<li>Validate framework is functioning by executing standard PyTest framework</li>
<li>Add code coverage evaluation process</li>
<li>Validate code coverage process</li>
<li>Generate documentation for custom test framework</li>
<li>Deploy custom test framework</li>
</ul>
</li>
<li>Generate 'man page' for custom test framework<ul>
<li>Using all of the configuration information from above, generate a
robust help and user guide for the custom test framework that has been
created.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="references">
<h1>References</h1>
<table class="docutils citation" frame="void" id="pytest" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[PyTest]</td><td>PyTest
Online: <a class="reference external" href="https://docs.PyTest.org/en/latest">https://docs.PyTest.org/en/latest</a></td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="arccoverage" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[ArcCoverage]</a></td><td>Arcanist Coverage
Online: <a class="reference external" href="https://coverage.readthedocs.io/en/coverage-4.4.1/">https://coverage.readthedocs.io/en/coverage-4.4.1/</a></td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="arcanisttesting" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[ArcanistTesting]</a></td><td>Arcanist Testing Frameworks Online:
<a class="reference external" href="https://secure.phabricator.com/book/phabricator/article/arcanist_lint_unit">https://secure.phabricator.com/book/phabricator/article/arcanist_lint_unit</a>.</td></tr>
</tbody>
</table>
</div>
</div>
</body>
</html>
